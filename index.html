<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VR8VH5T2XQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-VR8VH5T2XQ');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Urdu Text Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind CSS for class-based dark mode
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .urdu-text, .urdu-input {
            font-family: 'Noto Nastaliq Urdu', serif;
            direction: rtl;
        }
        /* Custom focus ring for better visibility */
        .focus-visible\:ring-blue-500:focus-visible {
            --tw-ring-color: #3b82f6;
        }
        /* Smooth transition for color changes */
        body, .bg-white, .bg-gray-50, .urdu-input, h1, p {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        /* Custom scrollbar for better aesthetics */
        #lockedText::-webkit-scrollbar, #urduInput::-webkit-scrollbar {
            width: 8px;
        }
        #lockedText::-webkit-scrollbar-track, #urduInput::-webkit-scrollbar-track {
            background: transparent;
        }
        #lockedText::-webkit-scrollbar-thumb, #urduInput::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.5);
            border-radius: 20px;
            border: 3px solid transparent;
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-4 sm:p-6 bg-gray-100 dark:bg-zinc-950 overflow-hidden">

    <div class="w-full max-w-4xl mx-auto h-full flex flex-col bg-white dark:bg-zinc-900 rounded-2xl shadow-lg overflow-hidden">
        <div class="p-4 sm:p-6 border-b border-gray-200 dark:border-zinc-800 flex-shrink-0">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 dark:text-gray-100 text-center urdu-text">اردو ٹیکسٹ ایڈیٹر</h1>
            <p class="text-gray-500 dark:text-gray-400 text-center mt-2">Urdu Text Editor</p>
        </div>

        <div class="flex-grow min-h-0 relative">
            <div id="editor-container" class="absolute inset-0 flex flex-col p-4 sm:p-6">
                <textarea id="urduInput" class="urdu-input w-full bg-gray-50 dark:bg-zinc-800 dark:text-gray-200 dark:placeholder-gray-400 rounded-lg border-2 border-transparent focus:border-blue-500 focus:ring-0 outline-none resize-none text-xl flex-grow p-4"></textarea>
                <!-- Character and Word Counter -->
                <div id="text-stats" class="flex justify-end text-sm text-gray-500 dark:text-gray-400 mt-2 pr-1 urdu-text flex-shrink-0">
                    <span>الفاظ: 0</span>
                    <span class="mx-2">|</span>
                    <span>حروف: 0</span>
                </div>
            </div>
            <div id="viewer-container" class="hidden absolute inset-0 flex flex-col p-4 sm:p-6">
                <div id="lockedText" class="urdu-text w-full h-full bg-gray-50 dark:bg-zinc-800 dark:text-gray-200 rounded-lg text-xl overflow-y-auto p-4"></div>
            </div>
        </div>

        <div class="p-4 bg-white dark:bg-zinc-900 border-t border-gray-200 dark:border-zinc-800 flex flex-col justify-center items-center gap-2 rounded-b-2xl flex-shrink-0">
            <div class="flex justify-center items-center gap-2">
                <button id="toggleLockBtn" title="Lock/Edit" class="h-10 w-10 flex items-center justify-center bg-rose-200 text-rose-800 rounded-full hover:bg-rose-300 focus:outline-none focus:ring-4 focus:ring-rose-100 transition-all transform hover:scale-105">
                    <i data-lucide="lock" id="lockIcon"></i>
                    <i data-lucide="pencil" id="editIcon" class="hidden"></i>
                </button>
                <button id="copyBtn" title="Copy Text" class="h-10 w-10 flex items-center justify-center bg-amber-200 text-amber-800 rounded-full hover:bg-amber-300 focus:outline-none focus:ring-4 focus:ring-amber-100 transition-all transform hover:scale-105 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed disabled:transform-none" disabled>
                    <i data-lucide="copy"></i>
                </button>
                <button id="printBtn" title="Save as PDF" class="h-10 w-10 flex items-center justify-center bg-sky-200 text-sky-800 rounded-full hover:bg-sky-300 focus:outline-none focus:ring-4 focus:ring-sky-100 transition-all transform hover:scale-105 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed disabled:transform-none" disabled>
                     <i data-lucide="save"></i>
                </button>
                <button id="lineSpacingBtn" title="Change Line Spacing" class="h-10 w-10 flex items-center justify-center bg-emerald-200 text-emerald-800 rounded-full hover:bg-emerald-300 focus:outline-none focus:ring-4 focus:ring-emerald-100 transition-all transform hover:scale-105">
                    <i data-lucide="pilcrow"></i>
                </button>
                <button id="darkModeToggle" title="Toggle Dark Mode" class="h-10 w-10 flex items-center justify-center bg-slate-200 dark:bg-zinc-700 text-slate-600 dark:text-white rounded-full hover:bg-slate-300 dark:hover:bg-zinc-600 focus:outline-none focus:ring-4 focus:ring-slate-100 dark:focus:ring-zinc-600 transition-all transform hover:scale-105">
                    <i data-lucide="moon" id="moonIcon"></i>
                    <i data-lucide="sun" id="sunIcon" class="hidden"></i>
                </button>
                <button id="decreaseFontBtn" title="Decrease Font Size" class="h-10 w-10 flex items-center justify-center bg-slate-200 dark:bg-zinc-700 text-slate-600 dark:text-gray-200 rounded-full hover:bg-slate-300 dark:hover:bg-zinc-600 focus:outline-none focus:ring-4 focus:ring-slate-100 dark:focus:ring-zinc-600 transition-all transform hover:scale-105">
                    <i data-lucide="zoom-out"></i>
                </button>
                <button id="increaseFontBtn" title="Increase Font Size" class="h-10 w-10 flex items-center justify-center bg-slate-200 dark:bg-zinc-700 text-slate-600 dark:text-gray-200 rounded-full hover:bg-slate-300 dark:hover:bg-zinc-600 focus:outline-none focus:ring-4 focus:ring-slate-100 dark:focus:ring-zinc-600 transition-all transform hover:scale-105">
                    <i data-lucide="zoom-in"></i>
                </button>
            </div>
            <!-- Animated Feedback Message -->
            <div id="feedback-message" class="text-center text-sm transition-opacity duration-300 opacity-0 h-6 pt-1"></div>
        </div>
    </div>

    <script>
        // DOM Elements
        const urduInput = document.getElementById('urduInput');
        const lockedText = document.getElementById('lockedText');
        const editorContainer = document.getElementById('editor-container');
        const viewerContainer = document.getElementById('viewer-container');
        
        const toggleLockBtn = document.getElementById('toggleLockBtn');
        const lockIcon = document.getElementById('lockIcon');
        const editIcon = document.getElementById('editIcon');
        
        const copyBtn = document.getElementById('copyBtn');
        const printBtn = document.getElementById('printBtn');
        const lineSpacingBtn = document.getElementById('lineSpacingBtn');
        const feedbackMessage = document.getElementById('feedback-message');
        const textStats = document.getElementById('text-stats');
        
        const htmlElement = document.documentElement;
        const darkModeToggle = document.getElementById('darkModeToggle');
        const moonIcon = document.getElementById('moonIcon');
        const sunIcon = document.getElementById('sunIcon');
        const decreaseFontBtn = document.getElementById('decreaseFontBtn');
        const increaseFontBtn = document.getElementById('increaseFontBtn');

        let isLocked = false;
        let currentFontSize = 20; // Corresponds to text-xl
        let currentLineHeightIndex = 2; // Default to '3'
        const lineHeights = ['1.5', '2', '3', '4'];

        // --- Core Functions ---

        function updateTextStats() {
            const text = urduInput.value;
            const chars = text.length;
            const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            
            textStats.innerHTML = `<span>الفاظ: ${words}</span><span class="mx-2">|</span><span>حروف: ${chars}</span>`;

            // Save to local storage
            localStorage.setItem('urduTextContent', text);
        }

        function applyFontSize(size) {
            // Clamp font size between 12px and 48px
            currentFontSize = Math.max(12, Math.min(size, 48));
            urduInput.style.fontSize = `${currentFontSize}px`;
            lockedText.style.fontSize = `${currentFontSize}px`;
            localStorage.setItem('urduEditorFontSize', currentFontSize);
        }

        function applyLineHeight(height) {
            urduInput.style.lineHeight = height;
            lockedText.style.lineHeight = height;
            localStorage.setItem('urduEditorLineHeight', height);
        }

        // --- Event Listeners ---

        urduInput.addEventListener('input', updateTextStats);

        toggleLockBtn.addEventListener('click', () => {
            isLocked = !isLocked;
            const currentText = urduInput.value;

            if (isLocked) {
                // Lock the text
                lockedText.innerText = currentText || 'کوئی متن درج نہیں کیا گیا';
                editorContainer.classList.add('hidden');
                viewerContainer.classList.remove('hidden');
                
                lockIcon.classList.add('hidden');
                editIcon.classList.remove('hidden');
                toggleLockBtn.setAttribute('title', 'Edit');

                // Enable copy and print buttons if there is text
                const hasText = currentText.trim() !== '';
                copyBtn.disabled = !hasText;
                printBtn.disabled = !hasText;
            } else {
                // Unlock for editing
                editorContainer.classList.remove('hidden');
                viewerContainer.classList.add('hidden');
                
                lockIcon.classList.remove('hidden');
                editIcon.classList.add('hidden');
                toggleLockBtn.setAttribute('title', 'Lock');

                // Always disable copy and print when editing
                copyBtn.disabled = true;
                printBtn.disabled = true;
            }
        });
        
        lineSpacingBtn.addEventListener('click', () => {
            currentLineHeightIndex = (currentLineHeightIndex + 1) % lineHeights.length;
            const newLineHeight = lineHeights[currentLineHeightIndex];
            applyLineHeight(newLineHeight);
        });
        
        // --- Utility Functions ---

        function showFeedback(message, isError = false) {
            feedbackMessage.textContent = message;
            feedbackMessage.className = `text-center text-sm transition-opacity duration-300 opacity-100 h-6 pt-1 ${isError ? 'text-red-500 dark:text-red-400' : 'text-green-600 dark:text-green-400'}`;
            
            setTimeout(() => {
                feedbackMessage.classList.replace('opacity-100', 'opacity-0');
            }, 2000);
        }

        // --- Button Event Listeners ---

        copyBtn.addEventListener('click', () => {
            if (!isLocked || !lockedText.innerText) return;
            
            // Use modern clipboard API if available
            if (navigator.clipboard) {
                navigator.clipboard.writeText(lockedText.innerText).then(() => {
                    showFeedback('متن کاپی ہو گیا!');
                }).catch(err => {
                    console.error('Failed to copy text with modern API: ', err);
                    // Fallback for iFrame restrictions
                    fallbackCopy();
                });
            } else {
                fallbackCopy();
            }
        });
        
        function fallbackCopy() {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = lockedText.innerText;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                document.execCommand('copy');
                showFeedback('متن کاپی ہو گیا!');
            } catch (err) {
                console.error('Failed to copy text with fallback: ', err);
                showFeedback('کاپی کرنے میں ناکامی!', true);
            }
            document.body.removeChild(tempTextArea);
        }

        printBtn.addEventListener('click', () => {
            if (!isLocked || !lockedText.innerText) return;

            const element = document.createElement('div');
            // Use pre-wrap to preserve line breaks and spacing
            element.innerHTML = `<div style="font-family: 'Noto Nastaliq Urdu', serif; direction: rtl; padding: 40px; font-size: 20px; white-space: pre-wrap; word-wrap: break-word;">${lockedText.innerText}</div>`;
            
            const opt = {
                margin:      1,
                filename:    'urdu-text.pdf',
                image:       { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, letterRendering: true },
                jsPDF:       { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            showFeedback('پی ڈی ایف تیار کی جا رہی ہے...');
            html2pdf().from(element).set(opt).save().then(() => {
                showFeedback('پی ڈی ایف محفوظ ہو گئی!');
            }).catch(err => {
                showFeedback('پی ڈی ایف بنانے میں ناکامی!', true);
                console.error('PDF generation failed:', err);
            });
        });
        
        increaseFontBtn.addEventListener('click', () => applyFontSize(currentFontSize + 2));
        decreaseFontBtn.addEventListener('click', () => applyFontSize(currentFontSize - 2));

        // --- Dark Mode Logic ---
        function applyTheme(isDark) {
            if (isDark) {
                htmlElement.classList.add('dark');
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
            } else {
                htmlElement.classList.remove('dark');
                moonIcon.classList.remove('hidden');
                sunIcon.classList.add('hidden');
            }
        }

        darkModeToggle.addEventListener('click', () => {
            const isCurrentlyDark = htmlElement.classList.contains('dark');
            localStorage.setItem('darkMode', !isCurrentlyDark);
            applyTheme(!isCurrentlyDark);
        });

        // --- Initialize page ---
        (() => {
            // Set dynamic viewport height to handle mobile keyboard
            const setVh = () => {
                document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
            };
            window.addEventListener('resize', setVh);
            setVh(); // Set initial value

            // Load saved theme
            const savedMode = localStorage.getItem('darkMode');
            if (savedMode !== null) {
                applyTheme(savedMode === 'true');
            } else {
                // Otherwise, check system preference
                const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                applyTheme(prefersDark);
            }
            
            // Load saved text
            const savedText = localStorage.getItem('urduTextContent');
            if (savedText) {
                urduInput.value = savedText;
            }
            
            // Load saved font size
            const savedFontSize = localStorage.getItem('urduEditorFontSize');
            if (savedFontSize) {
                applyFontSize(parseInt(savedFontSize, 10));
            } else {
                applyFontSize(20); // Default size
            }

            // Load saved line height
            const savedLineHeight = localStorage.getItem('urduEditorLineHeight');
            if (savedLineHeight && lineHeights.includes(savedLineHeight)) {
                applyLineHeight(savedLineHeight);
                const savedIndex = lineHeights.indexOf(savedLineHeight);
                if (savedIndex !== -1) {
                    currentLineHeightIndex = savedIndex;
                }
            } else {
                // Apply default line height
                applyLineHeight(lineHeights[currentLineHeightIndex]);
            }

            // Initial UI update
            updateTextStats();
            
            // Initialize Lucide icons
            lucide.createIcons();
        })();
    </script>
</body>
</html>
